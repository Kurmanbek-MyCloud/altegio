# üß™ –¢–µ—Å—Ç API Altegio - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤

–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ Altegio.

## üìÅ –§–∞–π–ª—ã

- `test_clients_api.php` - –û—Å–Ω–æ–≤–Ω–æ–π PHP —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API
- `curl_example.sh` - –ü—Ä–∏–º–µ—Ä—ã cURL –∑–∞–ø—Ä–æ—Å–æ–≤
- `clients_api.log` - –õ–æ–≥ —Ñ–∞–π–ª (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- `README.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### PHP —Ç–µ—Å—Ç
```bash
php test_clients_api.php
```

### cURL —Ç–µ—Å—Ç—ã
```bash
chmod +x curl_example.sh
./curl_example.sh
```

## üìã API Endpoint

**POST** `/company/{company_id}/clients/search`

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|-----|----------|--------------|
| `page` | number | –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã | `1` |
| `page_size` | number | –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–º–∞–∫—Å. 200) | `25` |
| `order_by` | string | –ü–æ–ª–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ | `"id"` |
| `order_by_direction` | string | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ | `"DESC"` |
| `operation` | string | –õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è | `"AND"` |
| `fields` | array | –í—ã–±–∏—Ä–∞–µ–º—ã–µ –ø–æ–ª—è | –í—Å–µ –ø–æ–ª—è |
| `filters` | array | –§–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ | - |

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏

- `id` - ID –∫–ª–∏–µ–Ω—Ç–∞
- `name` - –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞
- `phone` - –¢–µ–ª–µ—Ñ–æ–Ω
- `email` - Email
- `discount` - –°–∫–∏–¥–∫–∞
- `first_visit_date` - –î–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ –≤–∏–∑–∏—Ç–∞
- `last_visit_date` - –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∏–∑–∏—Ç–∞
- `sold_amount` - –°—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫
- `visit_count` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–∑–∏—Ç–æ–≤

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

- `=` - –†–∞–≤–Ω–æ
- `!=` - –ù–µ —Ä–∞–≤–Ω–æ
- `>` - –ë–æ–ª—å—à–µ
- `>=` - –ë–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
- `<` - –ú–µ–Ω—å—à–µ
- `<=` - –ú–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
- `LIKE` - –ü–æ–∏—Å–∫ –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ
- `IN` - –í—Ö–æ–¥–∏—Ç –≤ —Å–ø–∏—Å–æ–∫
- `NOT_IN` - –ù–µ –≤—Ö–æ–¥–∏—Ç –≤ —Å–ø–∏—Å–æ–∫

## üîß –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
```php
$result = getClientsList();
```

### 2. –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏
```php
$result = getClientsList([
    'filters' => [
        [
            'field' => 'name',
            'operation' => 'LIKE',
            'value' => '–ò–≤–∞–Ω'
        ]
    ]
]);
```

### 3. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
```php
$result = getClientsList([
    'order_by' => 'last_visit_date',
    'order_by_direction' => 'DESC',
    'page_size' => 10
]);
```

### 4. –ü–∞–≥–∏–Ω–∞—Ü–∏—è
```php
$result = getClientsList([
    'page' => 2,
    'page_size' => 50
]);
```

### 5. –í—ã–±–æ—Ä–∫–∞ –ø–æ–ª–µ–π
```php
$result = getClientsList([
    'fields' => ['id', 'name', 'phone', 'email']
]);
```

### 6. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
```php
$result = getClientsList([
    'filters' => [
        [
            'field' => 'visit_count',
            'operation' => '>=',
            'value' => 1
        ],
        [
            'field' => 'sold_amount',
            'operation' => '>',
            'value' => 0
        ]
    ],
    'operation' => 'AND'
]);
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞

```json
{
    "data": [
        {
            "id": 172280244,
            "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
            "phone": "+79001234567",
            "email": "ivan@example.com",
            "discount": 0,
            "first_visit_date": "2024-01-15",
            "last_visit_date": "2025-08-01",
            "sold_amount": 15000,
            "visit_count": 5
        }
    ],
    "meta": {
        "current_page": 1,
        "last_page": 10,
        "per_page": 25,
        "total": 250
    }
}
```

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:
- **Partner Token**: `gbkp3f4ynkd5jpejjsxp`
- **User Token**: `c1d3041f2185df70f5c341f0926adb44`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: `Authorization: Bearer partner_token, User user_token`

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª `clients_api_test.log` —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏.

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ú–µ—Ç–æ–¥**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `POST`, –∞ –Ω–µ `GET`
2. **Accept Header**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ `application/vnd.api.v2+json`
3. **–†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã**: –ú–∞–∫—Å–∏–º—É–º 200 –∑–∞–ø–∏—Å–µ–π
4. **–§–∏–ª—å—Ç—Ä—ã**: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Å–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
5. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**: –ü–æ –ª—é–±–æ–º—É –ø–æ–ª—é –≤ –ª—é–±–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏

## üßπ –û—á–∏—Å—Ç–∫–∞

–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ª–æ–≥ —Ñ–∞–π–ª–∞:
```bash
rm clients_api.log
``` 