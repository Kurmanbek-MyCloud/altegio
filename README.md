# Altegio Payments Integration

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π –≤ Altegio —á–µ—Ä–µ–∑ API –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–µ–±—Ö—É–∫–æ–≤.

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –ø–ª–∞—Ç–µ–∂–∏ –≤ Altegio –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–µ–π —Å –Ω–µ–Ω—É–ª–µ–≤–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é —É—Å–ª—É–≥. –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –≤–µ–±—Ö—É–∫–∏ –∏ API Altegio.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
altegio/
‚îú‚îÄ‚îÄ main.php              # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–µ–±—Ö—É–∫–æ–≤ Altegio
‚îú‚îÄ‚îÄ altegio_payments.php  # –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API Altegio
‚îú‚îÄ‚îÄ config.php            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ test_webhook.html     # –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤
‚îú‚îÄ‚îÄ README.md             # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ PAYMENTS_GUIDE.md     # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–ª–∞—Ç–µ–∂–∞–º
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `config.php`:

```php
'api' => [
    'user_token' => 'c1d3041f2185df70f5c341f0926adb44', // User token –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞
    'partner_token' => 'gbkp3f4ynkd5jpejjsxp', // –¢–æ–∫–µ–Ω –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞
    'company_id' => 729142, // ID –∫–æ–º–ø–∞–Ω–∏–∏
    'account_id' => 2665932, // ID –∫–∞—Å—Å—ã
],
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ –≤ Altegio

1. –ó–∞–π–¥–∏—Ç–µ –≤ –∫–∞–±–∏–Ω–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Altegio
2. –î–æ–±–∞–≤—å—Ç–µ URL –≤–µ–±—Ö—É–∫–∞: `https://your-domain.com/main.php`
3. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è:
   - `record.create` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
   - `visit.completed` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤–∏–∑–∏—Ç–∞

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
php -S localhost:8000
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ngrok (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ngrok
brew install ngrok

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–∫–µ–Ω–∞
ngrok config add-authtoken YOUR_TOKEN

# –ó–∞–ø—É—Å–∫ —Ç—É–Ω–Ω–µ–ª—è
ngrok http 8000
```

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏** –≤ Altegio —Å —É—Å–ª—É–≥–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é > 0 RUB
2. **–í–µ–±—Ö—É–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è** –Ω–∞ `main.php`
3. **–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –ø–ª–∞—Ç–µ–∂** —á–µ—Ä–µ–∑ API Altegio
4. **–ü–ª–∞—Ç–µ–∂ –ø–æ—è–≤–ª—è–µ—Ç—Å—è** –≤ –∫–∞—Å—Å–µ Altegio

## üìã –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è

- `record.create` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
- `visit.completed` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤–∏–∑–∏—Ç–∞
- `transaction.created` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `transaction.updated` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `payment.received` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- `payment.failed` - –Ω–µ—É–¥–∞—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂

## üîß API Endpoints

- `POST /finance_transactions/{company_id}` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `GET /finance_transactions/{id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `PUT /finance_transactions/{id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –≤–µ–¥–µ—Ç –ª–æ–≥–∏ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ–∞–π–ª–∞—Ö:
- `webhook_log.txt` - –ª–æ–≥–∏ –≤–µ–±—Ö—É–∫–æ–≤
- `payments_api.log` - –ª–æ–≥–∏ API –∑–∞–ø—Ä–æ—Å–æ–≤
- `notifications.txt` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–ª–∞—Ç–µ–∂–∞—Ö

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ `test_webhook.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –≤–µ–±—Ö—É–∫
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `webhook_log.txt`

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü—Ä–æ–≤–µ—Ä–∫–∞ IP-–∞–¥—Ä–µ—Å–æ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `config.php`)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–µ–±—Ö—É–∫–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `webhook_log.txt`
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–æ–≤ –≤ `config.php`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API Altegio
4. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ ID –∫–∞—Å—Å—ã –∏ –∫–æ–º–ø–∞–Ω–∏–∏

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License 